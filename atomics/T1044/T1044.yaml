---
attack_technique: T1044
display_name: File System Permissions Weakness

atomic_tests:
- name: File System Permissions Weakness
  description: |
    This test to show checking file system permissions weakness and which can lead to privilege escalation by replacing malicious file. Example; check weak file permission and then replace.
    powershell -c "Get-WmiObject win32_service | select PathName"   (check service file location) and
    copy /Y C:\temp\payload.exe C:\ProgramData\folder\Update\weakpermissionfile.exe   ( replace weak permission file with malicious file )

  supported_platforms:
    - windows

  input_arguments:
    weak_permission_file:
      description: check weak files permission
      type: path
      default: $env:TEMP\T1044_weak_permission_file.exe
    malicious_file:
      description: Wile to replace weak permission file with
      type: path
      default: $env:TEMP\T1044_malicious_file.exe

  dependency_executor_name: powershell
  dependencies:
    - description: |
        A file must exist on disk at specified location (#{weak_permission_file})
      prereq_command: |
        if (Test-Path #{weak_permission_file}) {exit 0} else {exit 1}
      get_prereq_command: |
        New-Item #{weak_permission_file} -Force | Out-Null
    - description: |
        


  executor:
    name: powershell
    elevation_required: false
    command: |
      Get-WmiObject win32_service | select PathName
      get-acl "#{weak_permission_file}" | FL | findstr "FullControl"
